import{r as k,t as x,Q as T,d as R,b as w,K as E,c as G,p as I,z as B,a as M,A as N,E as P,o as A,h as s,i as e,k as i,F as u,l as H,H as V,Y as W,m as D,g as a,Z as Y,v as $,j,I as z}from"./index-422a1f0d.js";import{u as K}from"./useWieghtedList-3f84915c.js";const g=k({baseChanceForWeapon:20,baseChanceForArmor:40,baseChanceForPotion:60,baseChanceForGold:80,baseChanceForHigherTierLoot:5,baseLootChance:50,baseChanceFor2TierLoot:40,isHigherTierLoot:!1,lootList:[],isLootSearched:!1}),O=()=>{const _=h=>{const m=new T,{getWeightedItem:v}=K(),c=v(h),t=m.createItemById(c);if(!t){console.error("Could not generate item");return}return g.lootList.push(t),t};return{...x(g),weightedRandom:_}},Q={class:"m-main o-levelFinished"},Z={class:"o-levelFinished__textContainer"},q=e("h1",{class:"o-levelFinished__title"},"Enemies defeated!",-1),J=e("p",null,"Search for loot",-1),U=e("p",{class:"o-levelFinished__text"},"You found:",-1),X=["onClick"],oe=R({__name:"LevelFinished",setup(_){const{updateTurnStateMachine:h,resetTurn:m}=w(),v=E(),{player:c}=G(),{isLootSearched:t,lootList:l,weightedRandom:y}=O(),n=I(),d=B(),{updateGameState:C}=M(),S=N();h(P.Disabled),S.resetBattleFeed();const b=async()=>{if(n.activeRoom){if(n.activeRoom.isExplored=!0,console.log(n.activeRoom),d.coords.x===void 0||d.coords.y===void 0){console.error("No previous player position");return}await n.saveScene({x:d.coords.x,y:d.coords.y},n.sceneList),m()}},L=p=>{const r=c.value.inventory.addItem(p,c.value.id);if(!r.status){console.log(r.message);return}const o=l.value.findIndex(f=>f.id===p.id);l.value.splice(o,1)},F=async()=>{t.value=!1,v.push({name:"home",state:{nextLevel:!0}}),C(D.Travel)};return A(async()=>{await b()}),(p,r)=>(a(),s("div",Q,[e("div",Z,[q,i(t)?(a(),s(u,{key:1},[U,H(W,{name:"fade"},{default:V(()=>[i(l).length?(a(!0),s(u,{key:0},$(i(l),o=>(a(),s("div",{key:o.id,class:"m-lootCard"},[e("p",null,j(o.name),1),e("button",{class:"m-lootCard__button",onClick:f=>L(o)},"take",8,X)]))),128)):(a(),s(u,{key:1},[z("Nothing interesting")],64))]),_:1})],64)):(a(),s(u,{key:0},[J,e("button",{class:"a-button",onClick:r[0]||(r[0]=o=>(i(y)(i(Y).goblin),t.value=!0))}," Search ")],64)),e("button",{onClick:F,class:"a-button"},"Continue")])]))}});export{oe as default};
