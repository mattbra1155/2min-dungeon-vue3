import{r as re,t as ce,d as A,u as z,a as O,b as V,c as q,e as ee,f as te,o as J,g as n,h as i,i as u,j as g,k as e,n as Q,E as G,l as I,_ as K,m as C,p as j,q as P,s as y,F as T,v as M,w as le,x as Y,y as de,z as ue,A as U,B as me,C as ve,D as W,G as _e,H as oe,T as se,I as Z,J as N,K as fe}from"./index-422a1f0d.js";import ae from"./KnapsackIcon-02ed09da.js";import ne from"./CharacterScreenIcon-e5f8abf3.js";import{u as he}from"./useWieghtedList-3f84915c.js";const D=re({targetToAttack:null}),ie=()=>{const m=l=>{D.targetToAttack=l};return{...ce(D),setTargetToAttack:m}},pe={class:"o-interface"},be={class:"o-header__healthItem --player"},ge={class:"o-header__name"},ye=["max","value"],ke=u("p",{id:"playerHp"},null,-1),Se=["disbaled"],Re={class:"o-interface__row"},$e=A({__name:"LayoutInterfaceCombat",setup(m){const l=z(),{activeGameState:a}=O(),{activeTurnState:o,checkIfDead:s,updateTurnStateMachine:t}=V(),{targetToAttack:r}=ie(),{player:d}=q(),{toggleInventory:v}=ee(),{toggleCharacterScreen:h}=te(),k=()=>{console.log(l.isAttacking),r.value&&!l.isAttacking&&(d.value.attack(r.value),s(),t(G.EnemyAttack))},S=()=>{window.addEventListener("keyup",p=>{if(p.key==="i"){v();return}if(p.key==="c"){h();return}if(a.value===C.Battle&&p.code==="Space"){k();return}})};return J(()=>{S()}),(p,F)=>{var H;return n(),i("div",pe,[u("div",be,[u("h2",ge,g((H=e(d))==null?void 0:H.name),1),u("meter",{class:"o-header__meter",min:"0",max:e(d).stats.hp,low:"30",value:e(d).currentStats.hp},g(e(d).currentStats.hp?e(d).currentStats.hp:0),9,ye),ke]),u("button",{id:"attackButtonOne",type:"button",class:Q(["a-button action__button",{"--disabled":e(l).isAttacking}]),onClick:k,disbaled:e(o)!==e(G).PlayerAttack||e(l).isAttacking||!e(d).isAlive}," Attack ",10,Se),u("div",Re,[u("button",{id:"inventoryButton",type:"button",class:"a-button action__button",onClick:F[0]||(F[0]=(...B)=>e(v)&&e(v)(...B))},[I(K,{icon:ae})]),u("button",{class:"a-button action__button",onClick:F[1]||(F[1]=(...B)=>e(h)&&e(h)(...B))},[I(K,{icon:ne})])])])}}}),Ce={id:"top-bar",class:"o-header"},Te={key:0,id:"levelName",class:"level__name"},Le={key:1,style:{"text-align":"center"}},xe={key:2},Ie={style:{"text-align":"center"}},Ae={style:{"text-align":"center"}},Fe={class:"o-header__healthWrapper"},we=["onClick"],Oe={id:"monsterHp",class:"health--monster"},Me=["max","value"],je=A({__name:"LayoutTopBar",setup(m){const{targetToAttack:l,setTargetToAttack:a}=ie(),o=j(),{activeGameState:s}=O(),{activeTurnState:t,turnNumber:r,turnOrder:d}=V(),v=P(()=>d.value),h=P(()=>o.instanceList.find(k=>{var S;return k.id===((S=o.instance)==null?void 0:S.id)}));return(k,S)=>(n(),i("div",Ce,[e(o).activeRoom?(n(),i("h2",Te,g(e(o).activeRoom.name),1)):y("",!0),e(o).instance?(n(),i("p",Le,g(h.value),1)):y("",!0),e(s)===e(C).Battle?(n(),i("div",xe,[u("p",Ie,g(e(t)),1),u("p",Ae,"Turn: "+g(e(r)),1)])):y("",!0),u("div",Fe,[(n(!0),i(T,null,M(v.value,p=>(n(),i(T,{key:p.id},[p.isAlive?(n(),i("div",{key:0,class:Q(["o-header__healthItem --enemy",{"--active":e(l)===p}])},[u("h2",{onClick:F=>e(a)(p),class:"o-header__name",id:"monsterName"},g(p.name?p.name:"placeholder enemy"),9,we),u("p",Oe,[u("meter",{min:"0",max:p.stats.hp,low:"30",value:p.currentStats.hp},g(p.currentStats.hp?p.currentStats.hp:0),9,Me)])],2)):y("",!0)],64))),128))])]))}});var $=(m=>(m[m.Wall=-1]="Wall",m[m.North=0]="North",m[m.East=1]="East",m[m.South=2]="South",m[m.West=3]="West",m))($||{});const Be={grassland:[{item:"orc",probability:10},{item:"goblin",probability:40},{item:"lesserGoblin",probability:70}],road:[{item:"lesserGoblin",probability:50}],fields:[{item:"goblin",probability:40},{item:"lesserGoblin",probability:80}],forest:[{item:"skeleton",probability:10},{item:"orc",probability:40},{item:"goblin",probability:50}],hinterlands:[{item:"ogr",probability:20},{item:"goblin",probability:40},{item:"orc",probability:60}],darkForest:[{item:"liche",probability:10},{item:"ogr",probability:40},{item:"orc",probability:60},{item:"skeleton",probability:80}]},Ee=le("randomEncounters",()=>{const m=j(),{updateGameState:l}=O(),{setMonsterList:a}=V(),o=Y(),s=Y(!1);return Y(0),{roll:o,isBattle:s,rollEncounter:r=>{o.value=void 0,s.value=!1,o.value=de();const d={road:5,fields:15,grassland:20,hinterlands:25,forest:30,darkForest:35};if(console.log(o.value),r==="road"&&o.value<=d.road&&(s.value=!0),r==="grassland"&&o.value<=d.grassland&&(s.value=!0),r==="fields"&&o.value<=d.fields&&(s.value=!0),r==="forest"&&o.value<=d.forest&&(s.value=!0),r==="hinterlands"&&o.value<=d.hinterlands&&(s.value=!0),r==="darkForest"&&o.value<=d.darkForest&&(s.value=!0),!s.value)return!1;const v=[],{getWeightedItem:h}=he(),k=h(Be[r]);v.push(k);const S=m.createEnemyList(v);l(C.Battle),a(S)}}}),Ge={key:0,class:"o-interface"},Ye={class:"o-interface__row o-interface__objectActions"},Ne=["onClick"],Pe=["disabled"],We={class:"o-interface__row o-interface__directionWrapper"},He=["onClick","disabled"],Ke={class:"o-interface__row"},Ve=A({__name:"LayoutInterfaceTravel",setup(m){const{toggleInventory:l}=ee(),{toggleCharacterScreen:a}=te(),o=ue(),s=U(),t=j(),r=Ee(),{updateGameState:d}=O(),v=z(),h=P(()=>{var c;return(c=t.activeRoom)==null?void 0:c.isSearched}),k=()=>{window.addEventListener("keydown",c=>{c.key==="i"&&l(),c.key==="c"&&a(),c.key,c.key,c.key,c.key})},S=async c=>{var E,X;if(!t||o.coords.x===void 0||o.coords.y===void 0)return;v.isMoving=!0;const b=["footsteps/Steps_dirt-001.ogg","footsteps/Steps_dirt-002.ogg","footsteps/Steps_dirt-003.ogg"],L=["footsteps/Steps_dirt-004.ogg","footsteps/Steps_dirt-005.ogg","footsteps/Steps_dirt-006.ogg"],x=Math.random()<=.5?b:L;me(x),t.loadingArea=!0;const _=structuredClone(ve(o.coords));let f={x:0,y:0};if(s.resetTravelFeed(),c===$.North?(f={x:o.coords.x,y:o.coords.y-1},s.setTravelFeedItem("You move north")):c===$.East?(f={x:o.coords.x+1,y:o.coords.y},s.setTravelFeedItem("You move east")):c===$.South?(f={x:o.coords.x,y:o.coords.y+1},s.setTravelFeedItem("You move south")):c===$.West&&(f={x:o.coords.x-1,y:o.coords.y},s.setTravelFeedItem("You move west")),o.updateCoords(f.x,f.y),!t.changeActiveRoom(o.coords.x,o.coords.y)){if(console.error("No current Room"),_.x===void 0||_.y===void 0){console.error("No previous player position");return}o.updateCoords(_.x,_.y),t.changeActiveRoom(o.coords.x,o.coords.y),s.setTravelFeedItem("You travel back.")}const w=t.getLocationData(o.coords.x,o.coords.y);w&&r.rollEncounter(w.id),s.setTravelFeedItem(`You have entered ${(E=t.activeRoom)==null?void 0:E.name}.`),s.setTravelFeedItem(`${(X=t.activeRoom)==null?void 0:X.description}`),t.getClosestTiles(),await t.saveScene({x:o.coords.x,y:o.coords.y},t.sceneList),setTimeout(()=>{t.loadingArea=!1,v.isMoving=!1},800)},p=c=>{var L,x,_,f;let b;return c===$.North?b=(L=Object.entries($).find(R=>R[0]===c.toString()))==null?void 0:L[1]:c===$.East?b=(x=Object.entries($).find(R=>R[0]===c.toString()))==null?void 0:x[1]:c===$.South?b=(_=Object.entries($).find(R=>R[0]===c.toString()))==null?void 0:_[1]:c===$.West&&(b=(f=Object.entries($).find(R=>R[0]===c.toString()))==null?void 0:f[1]),b},F=()=>{if(!t.activeRoom||!t.activeRoom){console.error("SEARCH ROOM: no current room");return}t.activeRoom.searchRoom()},H=async(c,b)=>{var L,x,_,f;if(!(!t.activeRoom||!c||!b)){if(v.isMoving=!0,c==="overworld"){const R=t.sceneList.find(w=>w.id===b);if(!R){console.error("no exit location found"),v.isMoving=!1;return}t.instance=void 0,t.setActiveScene(R),s.resetTravelFeed(),s.setTravelFeedItem(`You have entered ${(L=t.activeRoom)==null?void 0:L.name}`),s.setTravelFeedItem(`${(x=t.activeRoom)==null?void 0:x.description}`),t.getClosestTiles(),v.isMoving=!1;return}console.log("start creating locations"),console.time("tt"),await t.createInstanceLocations(c,b),console.timeEnd("tt"),console.log("end creating locations"),s.resetTravelFeed(),s.setTravelFeedItem(`You have entered ${(_=t.activeRoom)==null?void 0:_.name}`),s.setTravelFeedItem(`${(f=t.activeRoom)==null?void 0:f.description}`),t.getClosestTiles(),v.isMoving=!1}},B=c=>{v.isMoving=!0,d(C.Loot),s.setActiveRoomObject(c)};return J(()=>{k()}),(c,b)=>{var L,x;return e(t).activeRoom?(n(),i("div",Ge,[u("div",Ye,[(n(!0),i(T,null,M((L=e(t).activeRoom)==null?void 0:L.roomObjects,_=>{var f;return n(),i(T,{key:_.id},[((f=e(s).activeRoomObject)==null?void 0:f.id)!==_.id&&e(t).activeRoom.isSearched?(n(),i("button",{key:0,class:"a-button action__button",onClick:R=>B(_)}," Search "+g(_.name),9,Ne)):y("",!0)],64)}),128)),h.value?y("",!0):(n(),i("button",{key:0,class:"a-button action__button",onClick:F},"Search Room")),e(t).activeRoom&&e(t).activeRoom.connectedLocation!==void 0?(n(),i(T,{key:1},[e(t).activeRoom.connectedLocation?(n(),i("button",{key:0,class:"a-button action__button",onClick:b[0]||(b[0]=_=>{var f,R,w,E;return H((R=(f=e(t).activeRoom)==null?void 0:f.connectedLocation)==null?void 0:R.id,(E=(w=e(t).activeRoom)==null?void 0:w.connectedLocation)==null?void 0:E.entryId)})}," Enter "+g((x=e(t).activeRoom)==null?void 0:x.name),1)):y("",!0)],64)):y("",!0),e(t).activeRoom.id==="oakwood"?(n(),i("button",{key:2,class:"a-button action__button",onClick:b[1]||(b[1]=_=>c.$router.push({name:"town"})),disabled:e(v).isMoving}," Enter "+g(e(t).activeRoom.name),9,Pe)):y("",!0)]),u("div",We,[(n(),i(T,null,M(4,(_,f)=>u("button",{key:f,class:"a-button action__button",onClick:R=>S(f),disabled:e(v).isMoving},g(p(f)),9,He)),64))]),u("div",Ke,[u("button",{id:"inventoryButton",type:"button",class:"a-button action__button",onClick:b[2]||(b[2]=(..._)=>e(l)&&e(l)(..._))},[I(K,{icon:ae})]),u("button",{class:"a-button action__button",onClick:b[3]||(b[3]=(..._)=>e(a)&&e(a)(..._))},[I(K,{icon:ne})])])])):y("",!0)}}}),Ue=A({__name:"FeedBattle",setup(m){const l=j(),a=U(),o=P(()=>{var t;return((t=l.activeRoom)==null?void 0:t.monsterList.map(r=>r.name))||[]});a.setBattleFeedItem(`You are being attacked by ${o.value.length>1?"enemies":"enemy"}: ${o.value}`);const s=Y();return W(()=>a.feedBattleList.length,()=>{!s.value||!s.value.lastElementChild||_e(()=>{var t;((t=s.value)==null?void 0:t.lastElementChild).scrollIntoView(!0)})}),(t,r)=>(n(),i("div",{class:"o-feed__container",ref_key:"feedList",ref:s},[(n(!0),i(T,null,M(e(a).feedBattleList,d=>(n(),i("p",{class:"o-feed__item",key:d},g(d.replace(",",", ")),1))),128))],512))}}),ze={key:0,id:"feedContainer",class:"o-feed__container"},qe=["src"],Je=A({__name:"FeedTravel",setup(m){const l=U(),a=j(),o=P(()=>{var t;return(t=a.activeRoom)!=null&&t.roomObjects.length?`There is a ${a.activeRoom.roomObjects.map(r=>{const d=r.isSearched&&r.items.length===0?"empty ":"",v=r.name;return`${d}${v}`})} here.`:"You see nothing worth taking."});return W(()=>{var s;return o.value&&((s=a.activeRoom)==null?void 0:s.isSearched)},()=>{l.setTravelFeedItem(o.value)}),W(()=>{var s;return(s=a.activeRoom)==null?void 0:s.isSearched},s=>{s&&l.setTravelFeedItem("You searched this room.")}),(s,t)=>e(a).activeRoom?(n(),i("div",{key:0,id:"feed",class:Q(["o-feed__travel",{"--loading":e(a).loadingArea}])},[I(se,{name:"fade"},{default:oe(()=>[e(a).loadingArea?y("",!0):(n(),i("ul",ze,[e(a).activeRoom.image?(n(),i("img",{key:0,class:"a-image",src:e(a).activeRoom.image,alt:""},null,8,qe)):y("",!0),(n(!0),i(T,null,M(e(l).feedTravelList,r=>(n(),i("p",{key:r},g(r),1))),128))]))]),_:1})],2)):y("",!0)}}),Qe={key:0},Xe={class:"o-feed__item"},Ze=["src"],De=["src"],et={class:"a-text --center"},tt=["onClick"],ot={key:1,class:"a-text --center"},st={key:0,class:"test"},at=A({__name:"FeedLoot",setup(m){const{player:l}=q(),a=U(),{updateGameState:o}=O(),s=z(),t=Y(),r=h=>{if(h.isLocked){h.unlock(l.value)?h.setIsSearch(!0):t.value=`You are unable to open the ${h.name}. You need a lockpicking skill.`;return}h.setIsSearch(!0)},d=(h,k)=>{const S=h.items.findIndex(p=>p.id===k.id);h.items.splice(S,1),l.value.inventory.addItem(k,l.value.id),h.items.length||a.setTravelFeedItem(`You took everything from ${h.name}`)},v=()=>{a.setActiveRoomObject(void 0),s.isMoving=!1,o(C.Travel)};return(h,k)=>e(a).activeRoomObject?(n(),i("div",Qe,[u("div",Xe,[e(a).activeRoomObject.image&&!e(a).activeRoomObject.isSearched?(n(),i("img",{key:0,class:"a-image --contain o-feed__image",src:e(a).activeRoomObject.image||"Treasure Chest open 254x254.png",alt:""},null,8,Ze)):e(a).activeRoomObject.imageSearched&&e(a).activeRoomObject.isSearched?(n(),i("img",{key:1,class:"a-image --contain o-feed__image",src:e(a).activeRoomObject.imageSearched,alt:""},null,8,De)):y("",!0),u("p",et,g(e(a).activeRoomObject.isLocked?`Locked ${e(a).activeRoomObject.name}`:e(a).activeRoomObject.name),1),e(a).activeRoomObject.isSearched?(n(),i(T,{key:2},[e(a).activeRoomObject.items.length?(n(),i(T,{key:0},[Z(" contains: "),(n(!0),i(T,null,M(e(a).activeRoomObject.items,S=>(n(),i("p",{key:S.id,class:"a-text"},[Z(g(S.name)+" ",1),u("button",{class:"a-button",onClick:p=>d(e(a).activeRoomObject,S)},"take",8,tt)]))),128))],64)):(n(),i("p",ot,"empty!"))],64)):y("",!0),e(a).activeRoomObject.isSearched?y("",!0):(n(),i("button",{key:3,onClick:k[0]||(k[0]=S=>r(e(a).activeRoomObject)),class:"a-button action__button"},g(e(a).activeRoomObject.isLocked?"Unlock":"Open"),1)),I(se,{name:"slide"},{default:oe(()=>[t.value?(n(),i("p",st,g(t.value),1)):y("",!0)]),_:1}),u("button",{class:"a-button",onClick:v},"Close")])])):y("",!0)}}),nt={class:"o-feed"},it=A({__name:"FeedPanel",setup(m){const{activeGameState:l}=O();return(a,o)=>(n(),i("div",nt,[e(l)===e(C).Battle?(n(),N(Ue,{key:0})):e(l)===e(C).Loot?(n(),N(at,{key:1})):(n(),N(Je,{key:2}))]))}}),rt={class:"home"},mt=A({__name:"Home",setup(m){const l=j(),{activeGameState:a}=O(),{updateTurnStateMachine:o}=V(),{player:s}=q(),t=fe();return a.value===C.Battle&&o(G.Init),W(()=>a.value,r=>{r===C.Travel&&o(G.Disabled),r===C.Battle&&o(G.Init),r===C.LevelCleared&&t.push({name:"levelFinished"})}),W(s.value,()=>{s.value.isAlive===!1&&t.push({name:"playerDead"})}),J(async()=>{await l.loadScene()}),(r,d)=>(n(),i("div",rt,[I(je),I(it),e(a)===e(C).Battle?(n(),N($e,{key:0})):(n(),N(Ve,{key:1}))]))}});export{mt as default};
