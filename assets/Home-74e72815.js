import{r as X,t as Z,d as L,u as ee,a as w,b as G,c as V,e as te,f as oe,o as K,g as r,h as i,i as o,j as l,k as y,l as S,n as z,E as Y,m as F,_ as O,p as R,q as M,s as H,F as T,v as A,w as le,x as N,y as de,z as ue,A as q,B as me,C as _e,D as ve,G as j,H as pe,I as fe,T as he,J as ge,K as ye,L as x,M as D,N as be}from"./index-3fb9effd.js";import ae from"./KnapsackIcon-a3eedead.js";import se from"./CharacterScreenIcon-98e07996.js";const U=X({targetToAttack:null}),ne=()=>{const u=n=>{U.targetToAttack=n};return{...Z(U),setTargetToAttack:u}},Se={class:"o-interface"},ke={key:0,class:"o-header__healthItem --player"},Ce={class:"o-header__name"},Re=["max","value"],$e=["disbaled"],Ie={class:"o-interface__row"},Le=L({__name:"LayoutInterfaceCombat",setup(u){const n=ee(),a=w(),t=G(),{targetToAttack:s}=ne(),e=V(),{toggleInventory:_}=te(),{toggleCharacterScreen:f}=oe(),m=()=>{e.player&&s.value&&!n.isAttacking&&(e.player.attack(s.value),t.checkIfDead(),t.updateTurnStateMachine(Y.EnemyAttack))},p=()=>{window.addEventListener("keyup",c=>{if(c.key==="i"){_();return}if(c.key==="c"){f();return}if(a.activeGameState===R.Battle&&c.code==="Space"){m();return}})};return K(()=>{p()}),(c,$)=>{var W;return r(),i("div",Se,[o(e).player?(r(),i("div",ke,[l("h2",Ce,y(o(e).player.name),1),l("meter",{class:"o-header__meter",min:"0",max:o(e).player.stats.hp,low:"30",value:o(e).player.currentStats.hp},y(o(e).player.currentStats.hp?o(e).player.currentStats.hp:0),9,Re),$[2]||($[2]=l("p",{id:"playerHp"},null,-1))])):S("",!0),l("button",{id:"attackButtonOne",type:"button",class:z(["a-button action__button",{"--disabled":o(n).isAttacking}]),onClick:m,disbaled:o(t).activeTurnState!==o(Y).PlayerAttack||o(n).isAttacking||!((W=o(e).player)!=null&&W.isAlive)}," Attack ",10,$e),l("div",Ie,[l("button",{id:"inventoryButton",type:"button",class:"a-button action__button",onClick:$[0]||($[0]=(...B)=>o(_)&&o(_)(...B))},[F(O,{icon:ae})]),l("button",{class:"a-button action__button",onClick:$[1]||($[1]=(...B)=>o(f)&&o(f)(...B))},[F(O,{icon:se})])])])}}}),Te={id:"top-bar",class:"o-header"},we={key:0,id:"levelName",class:"level__name"},xe={key:1,style:{"text-align":"center"}},Fe={key:2},Ae={style:{"text-align":"center"}},Ge={style:{"text-align":"center"}},Me={class:"o-header__healthWrapper"},Be=["onClick"],Ee={id:"monsterHp",class:"health--monster"},Pe=["max","value"],Ne=L({__name:"LayoutTopBar",setup(u){const{targetToAttack:n,setTargetToAttack:a}=ne(),t=M(),s=w(),e=G(),_=H(()=>e.turnOrder),f=H(()=>t.instanceList.find(m=>{var p;return m.id===((p=t.instance)==null?void 0:p.id)}));return(m,p)=>(r(),i("div",Te,[o(t).activeRoom&&o(s).activeGameState===o(R).Travel?(r(),i("h2",we,y(o(t).activeRoom.name),1)):S("",!0),o(t).instance?(r(),i("p",xe,y(f.value),1)):S("",!0),o(s).activeGameState===o(R).Battle?(r(),i("div",Fe,[l("p",Ae,y(o(e).activeTurnState),1),l("p",Ge,"Turn: "+y(o(e).turnNumber),1)])):S("",!0),l("div",Me,[(r(!0),i(T,null,A(_.value,c=>(r(),i(T,{key:c.id},[c.isAlive?(r(),i("div",{key:0,class:z(["o-header__healthItem --enemy",{"--active":o(n)===c}])},[l("h2",{onClick:$=>o(a)(c),class:"o-header__name",id:"monsterName"},y(c.name?c.name:"placeholder enemy"),9,Be),l("p",Ee,[l("meter",{min:"0",max:c.stats.hp,low:"30",value:c.currentStats.hp},y(c.currentStats.hp?c.currentStats.hp:0),9,Pe)])],2)):S("",!0)],64))),128))])]))}});var C=(u=>(u[u.Wall=-1]="Wall",u[u.North=0]="North",u[u.East=1]="East",u[u.South=2]="South",u[u.West=3]="West",u))(C||{});const re=()=>({getWeightedItem:n=>{let a;const t=[n[0].probability];for(a=1;a<n.length;a++)t[a]=n[a].probability+t[a-1];const s=Math.random()*t[t.length-1];for(a=0;a<t.length&&!(t[a]>s);a++);return console.log(t,s),n[a].item}}),We={grassland:[{item:"orc",probability:10},{item:"goblin",probability:40},{item:"lesserGoblin",probability:70}],road:[{item:"lesserGoblin",probability:50}],fields:[{item:"goblin",probability:40},{item:"lesserGoblin",probability:80}],forest:[{item:"skeleton",probability:10},{item:"orc",probability:40},{item:"goblin",probability:50}],hinterlands:[{item:"ogr",probability:20},{item:"goblin",probability:40},{item:"orc",probability:60}],dark_forest:[{item:"liche",probability:10},{item:"ogr",probability:40},{item:"orc",probability:60},{item:"skeleton",probability:80}]},Ye=le("randomEncounters",()=>{const u=M(),n=w();G();const a=N(),t=N(!1);return N(0),{roll:a,isBattle:t,rollEncounter:e=>{a.value=void 0,t.value=!1,a.value=de();const _={road:5,fields:15,grassland:20,hinterlands:25,forest:30,darkForest:80};if(console.log(a.value),console.log(e),e==="road"&&a.value<=_.road&&(t.value=!0),e==="grassland"&&a.value<=_.grassland&&(t.value=!0),e==="fields"&&a.value<=_.fields&&(t.value=!0),e==="forest"&&a.value<=_.forest&&(t.value=!0),e==="hinterlands"&&a.value<=_.hinterlands&&(t.value=!0),e==="dark_forest"&&a.value<=_.darkForest&&(t.value=!0),!t.value)return!1;const f=[],{getWeightedItem:m}=re(),p=m(We[e]);f.push(p),u.createEnemyList(f),n.updateGameState(R.Battle)}}}),Oe={key:0,class:"o-interface"},He={class:"o-interface__row o-interface__objectActions"},je=["onClick"],Ve=["disabled"],De={class:"o-interface__row o-interface__directionWrapper"},Ke=["onClick","disabled"],ze={class:"o-interface__row"},qe=L({__name:"LayoutInterfaceTravel",setup(u){const{toggleInventory:n}=te(),{toggleCharacterScreen:a}=oe(),t=ue(),s=q(),e=M(),_=Ye(),{updateGameState:f}=w(),m=ee(),p=H(()=>{var d;return(d=e.activeRoom)==null?void 0:d.isSearched}),c=()=>{window.addEventListener("keydown",d=>{d.key==="i"&&n(),d.key==="c"&&a(),d.key,d.key,d.key,d.key})},$=async d=>{var P,J;if(!e||t.coords.x===void 0||t.coords.y===void 0)return;m.isMoving=!0,e.loadingArea=!0;let v={x:0,y:0};const k=structuredClone(_e(t.coords)),I=["footsteps/Steps_dirt-001.ogg","footsteps/Steps_dirt-002.ogg","footsteps/Steps_dirt-003.ogg"],h=["footsteps/Steps_dirt-004.ogg","footsteps/Steps_dirt-005.ogg","footsteps/Steps_dirt-006.ogg"],g=e.getLocationData(t.coords.x,t.coords.y),b=Math.random()<=.5?I:h;if(ve(b),s.resetTravelFeed(),d===C.North?(v={x:t.coords.x,y:t.coords.y-1},s.setTravelFeedItem("You move north")):d===C.East?(v={x:t.coords.x+1,y:t.coords.y},s.setTravelFeedItem("You move east")):d===C.South?(v={x:t.coords.x,y:t.coords.y+1},s.setTravelFeedItem("You move south")):d===C.West&&(v={x:t.coords.x-1,y:t.coords.y},s.setTravelFeedItem("You move west")),t.updateCoords(v.x,v.y),!await e.checkIfChangeRoomIsPossible(t.coords.x,t.coords.y)){if(console.error("No current Room"),k.x===void 0||k.y===void 0){console.error("No previous player position");return}t.updateCoords(k.x,k.y),await e.checkIfChangeRoomIsPossible(t.coords.x,t.coords.y),s.setTravelFeedItem("You travel back.")}g&&_.rollEncounter(g.id),s.setTravelFeedItem(`You have entered ${(P=e.activeRoom)==null?void 0:P.name}.`),s.setTravelFeedItem(`${(J=e.activeRoom)==null?void 0:J.description}`),e.getClosestTiles(),await e.saveScene({x:t.coords.x,y:t.coords.y},e.sceneList),setTimeout(()=>{e.loadingArea=!1,m.isMoving=!1},800)},W=d=>{var k,I,h,g;let v;return d===C.North?v=(k=Object.entries(C).find(b=>b[0]===d.toString()))==null?void 0:k[1]:d===C.East?v=(I=Object.entries(C).find(b=>b[0]===d.toString()))==null?void 0:I[1]:d===C.South?v=(h=Object.entries(C).find(b=>b[0]===d.toString()))==null?void 0:h[1]:d===C.West&&(v=(g=Object.entries(C).find(b=>b[0]===d.toString()))==null?void 0:g[1]),v},B=()=>{if(!e.activeRoom||!e.activeRoom){console.error("SEARCH ROOM: no current room");return}e.activeRoom.searchRoom()},ie=async(d,v)=>{var k,I,h,g;if(!(!e.activeRoom||!d||!v)){if(m.isMoving=!0,d==="overworld"){const b=e.sceneList.find(E=>E.id===v);if(!b){console.error("no exit location found"),m.isMoving=!1;return}e.instance=void 0,e.setActiveLocation(b),s.resetTravelFeed(),s.setTravelFeedItem(`You have entered ${(k=e.activeRoom)==null?void 0:k.name}`),s.setTravelFeedItem(`${(I=e.activeRoom)==null?void 0:I.description}`),e.getClosestTiles(),m.isMoving=!1;return}console.log("start creating locations"),console.time("tt"),console.timeEnd("tt"),console.log("end creating locations"),s.resetTravelFeed(),s.setTravelFeedItem(`You have entered ${(h=e.activeRoom)==null?void 0:h.name}`),s.setTravelFeedItem(`${(g=e.activeRoom)==null?void 0:g.description}`),e.getClosestTiles(),m.isMoving=!1}},ce=d=>{m.isMoving=!0,f(R.Loot),s.setActiveRoomObject(d)};return K(()=>{c()}),(d,v)=>{var k,I;return o(e).activeRoom?(r(),i("div",Oe,[l("div",He,[(r(!0),i(T,null,A((k=o(e).activeRoom)==null?void 0:k.roomObjects,h=>{var g;return r(),i(T,{key:h.id},[((g=o(s).activeRoomObject)==null?void 0:g.id)!==h.id&&o(e).activeRoom.isSearched?(r(),i("button",{key:0,class:"a-button action__button",onClick:b=>ce(h)}," Search "+y(h.name),9,je)):S("",!0)],64)}),128)),p.value?S("",!0):(r(),i("button",{key:0,class:"a-button action__button",onClick:B},"Search Room")),o(e).activeRoom&&o(e).activeRoom.connectedLocation!==void 0?(r(),i(T,{key:1},[o(e).activeRoom.connectedLocation?(r(),i("button",{key:0,class:"a-button action__button",onClick:v[0]||(v[0]=h=>{var g,b,E,P;return ie((b=(g=o(e).activeRoom)==null?void 0:g.connectedLocation)==null?void 0:b.id,(P=(E=o(e).activeRoom)==null?void 0:E.connectedLocation)==null?void 0:P.entryId)})}," Enter "+y((I=o(e).activeRoom)==null?void 0:I.name),1)):S("",!0)],64)):S("",!0),o(e).activeRoom.id==="oakwood"?(r(),i("button",{key:2,class:"a-button action__button",onClick:v[1]||(v[1]=h=>o(me).push({name:"town"})),disabled:o(m).isMoving}," Enter "+y(o(e).activeRoom.name),9,Ve)):S("",!0)]),l("div",De,[(r(),i(T,null,A(4,(h,g)=>l("button",{key:g,class:"a-button action__button",onClick:b=>$(g),disabled:o(m).isMoving},y(W(g)),9,Ke)),64))]),l("div",ze,[l("button",{id:"inventoryButton",type:"button",class:"a-button action__button",onClick:v[2]||(v[2]=(...h)=>o(n)&&o(n)(...h))},[F(O,{icon:ae})]),l("button",{class:"a-button action__button",onClick:v[3]||(v[3]=(...h)=>o(a)&&o(a)(...h))},[F(O,{icon:se})])])])):S("",!0)}}}),Je=L({__name:"FeedBattle",setup(u){const n=q(),a=N();return j(()=>n.feedBattleList.length,()=>{!a.value||!a.value.lastElementChild||pe(()=>{var t;((t=a.value)==null?void 0:t.lastElementChild).scrollIntoView(!0)})}),(t,s)=>(r(),i("div",{class:"o-feed__container",ref_key:"feedList",ref:a},[(r(!0),i(T,null,A(o(n).feedBattleList,e=>(r(),i("p",{class:"o-feed__item",key:e},y(e.replace(",",", ")),1))),128))],512))}}),Ue={key:0,id:"feedContainer",class:"o-feed__container"},Qe=["src"],Xe=L({__name:"FeedTravel",setup(u){const n=q(),a=M(),t=H(()=>{var e;return(e=a.activeRoom)!=null&&e.roomObjects.length?`There are items here: ${a.activeRoom.roomObjects.map(_=>{const f=_.isSearched&&_.items.length===0?"empty ":"",m=_.name;return`${f}${m}`})}`:"You see nothing worth taking."});return j(()=>{var s;return t.value&&((s=a.activeRoom)==null?void 0:s.isSearched)},()=>{n.setTravelFeedItem(t.value)}),j(()=>{var s;return(s=a.activeRoom)==null?void 0:s.isSearched},s=>{s&&n.setTravelFeedItem("You searched this room.")}),(s,e)=>o(a).activeRoom?(r(),i("div",{key:0,id:"feed",class:z(["o-feed__travel",{"--loading":o(a).loadingArea}])},[F(he,{name:"fade"},{default:fe(()=>[o(a).loadingArea?S("",!0):(r(),i("ul",Ue,[o(a).activeRoom.image?(r(),i("img",{key:0,class:"a-image",src:o(a).activeRoom.image,alt:""},null,8,Qe)):S("",!0),(r(!0),i(T,null,A(o(n).feedTravelList,_=>(r(),i("p",{key:_},y(_),1))),128))]))]),_:1})],2)):S("",!0)}}),Q=X({baseChanceForWeapon:20,baseChanceForArmor:40,baseChanceForPotion:60,baseChanceForGold:80,baseChanceForHigherTierLoot:5,baseLootChance:50,baseChanceFor2TierLoot:40,isHigherTierLoot:!1,lootList:[],isLootSearched:!1}),Ze=()=>{const u=a=>{const{getWeightedItem:t}=re();return t(a)},n=a=>{const s=new ge().createItemById(a);if(!s)throw Error("Could not generate item");return Q.lootList.push(s),s};return{...Z(Q),generateItem:n,weightedRandom:u}},et={class:"o-feed__container"},tt={class:"lootItem"},ot={class:"lootItem__name"},at=["onClick"],st=L({__name:"FeedLoot",setup(u){const n=G(),a=V(),{weightedRandom:t,generateItem:s}=Ze(),e=N([]),_=()=>console.log(n.monsterList);n.monsterList.map(m=>{const p=t(ye.goblin),c=s(p);console.log(c),c&&e.value.push(c)});const f=m=>{var p,c;console.log(m),(c=a.player)==null||c.inventory.addItem(m,(p=a.player)==null?void 0:p.id),e.value=e.value.filter($=>$!==m)};return K(()=>{_()}),(m,p)=>(r(),i("div",et,[p[0]||(p[0]=l("p",{class:"a-text --center"},"You defeated your enemies",-1)),p[1]||(p[1]=l("p",{class:"a-text --center"},"and found:",-1)),(r(!0),i(T,null,A(e.value,c=>(r(),i("div",{class:"lootList",key:c.id},[l("div",tt,[l("p",ot,y(c.name),1),l("button",{class:"a-button",onClick:$=>f(c)},"Add",8,at)])]))),128))]))}});const nt={class:"o-feed"},rt=L({__name:"FeedPanel",setup(u){const n=w();return(a,t)=>(r(),i("div",nt,[o(n).activeGameState===o(R).Battle?(r(),x(Je,{key:0})):o(n).activeGameState===o(R).Loot?(r(),x(st,{key:1})):(r(),x(Xe,{key:2}))]))}}),it={class:"o-interface"},ct=L({__name:"LayoutInterfaceLoot",setup(u){const n=w(),a=()=>{n.updateGameState(R.Travel)};return(t,s)=>(r(),i("div",it,[l("div",{class:"o-interface__row"},[l("button",{class:"a-button",onClick:a},"Close")])]))}}),lt={class:"m-main o-playerDead"},dt={class:"o-playerDead__textContainer"},ut={class:"o-playerDead__text"},mt=L({__name:"PlayerDead",setup(u){const n=V(),a=G(),t=w(),s=M(),e=()=>{n.resetPlayer(),a.updateTurnStateMachine(Y.Disabled),t.updateGameState(R.Init),s.resetRoomList()};return(_,f)=>{var m,p,c;return r(),i("div",lt,[l("div",dt,[f[2]||(f[2]=l("h1",{class:"o-playerDead__title"},"YOU DIED",-1)),l("p",ut,[f[0]||(f[0]=D(" you were killed by:")),f[1]||(f[1]=l("br",null,null,-1)),D(" "+y((m=o(a).activeCharacter)==null?void 0:m.name)+" with a "+y((c=(p=o(a).activeCharacter)==null?void 0:p.weapon)==null?void 0:c.name),1)]),l("button",{onClick:e,class:"a-button"},"Try again")])])}}}),_t={class:"home"},ht=L({__name:"Home",setup(u){M();const n=w(),a=G(),t=V(),s=be();return n.activeGameState===R.Battle&&a.updateTurnStateMachine(Y.Init),j(()=>t.player,()=>{var e;((e=t.player)==null?void 0:e.isAlive)===!1&&s.push({name:"playerDead"})}),(e,_)=>(r(),i("div",_t,[D(y(o(n).activeGameState)+" ",1),F(Ne),F(rt),o(n).activeGameState===o(R).Battle?(r(),x(Le,{key:0})):o(n).activeGameState===o(R).Loot?(r(),x(ct,{key:1})):(r(),x(qe,{key:2})),o(n).activeGameState===o(R).PlayerDead?(r(),x(mt,{key:3})):S("",!0)]))}});export{ht as default};
